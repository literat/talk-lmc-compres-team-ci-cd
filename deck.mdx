import { Notes, Head, Appear } from "mdx-deck";
import lmcLogo from './images/lmc-logo.png'
import gitFlow from './images/git-flow.png'
import integrationPipeline from './images/integration-pipeline.png'
import deliveryPipeline from './images/delivery-pipeline.png'
import deploymentPipeline from './images/deployment-pipeline.png'
import { default as customTheme } from "./src/theme";
export const theme = customTheme;

<Head>
  <title>Compres Team CI/CD ‚Äì Tomas Litera</title>
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:creator" content="@tomaslitera" />
  <meta
    property="https://lmc-compres-team-ci-cd.netlify.app/presentation.png"
  />
  <meta
    property="og:title"
    content="Compres Team CI/CD ‚Äì Tomas Litera"
  />
</Head>

<img src={lmcLogo} width="120" />

# Compres Team CI/CD

_by Tom√°≈° Litera_

<Notes>Microphone, screen recording, start timer</Notes>

---

# Why CI/CD

<ul>
  <Appear>
    <li>fast</li>
    <li>frequent</li>
    <li>reliable</li>
    <li>automated</li>
    <li>consistent</li>
  </Appear>
</ul>

---

# The Flow

<img src={gitFlow} width="500" />

---

## Continuous Integration

<img src={integrationPipeline} />

---

<ul>
  <Appear>
    <li>lint</li>
    <li>unit tests</li>
    <li>check types</li>
    <li>check code format</li>
    <li>code quality check (SonarQube <a href="https://confluence.int.lmc.cz/display/TECH/Running+Sonar+Qube+Scan+on+Jenkins" target="_blank">‚Üí How To)</a></li>
  </Appear>
</ul>

---

### Semi-Automated Release

* manual work
* How should I deploy your App in your team?

You must click in Narwhal!

TODO: images?
TODO: jobs.cz seznam krok≈Ø

---

## Continuous Delivery

<img src={deliveryPipeline} />

---

<ul>
  <Appear>
    <li>build üèóÔ∏è</li>
    <li>ship üö¢</li>
    <li>deploy üöÄ</li>
  </Appear>
</ul>

---

### Automated Release

<ul>
  <Appear>
    <li>kukad: local ‚Üí dev2-ict ‚Üí prod-ict</li>
    <li>fp-admin: local ‚Üí dev32 ‚Üí devel6, dev25, dev36, deploy ‚Üí prod (manual ü§∑‚Äç‚ôÇÔ∏è)</li>
  </Appear>
</ul>

---

## Continuous Deployment

Continuous Integration + Continuous Delivery = Continuous Deployment

<img src={deploymentPipeline} />

---

# Tools and Examples

---

## Integration branch

https://bitbucket.lmc.cz/projects/FP/repos/fp-admin/browse/bin/integrate.sh

https://bitbucket.lmc.cz/projects/FP/repos/fp-admin/browse/Jenkinsfile_integration

https://bitbucket.lmc.cz/projects/FP/repos/fp-admin/browse/bin/run-integration.sh

---

## Versioning

https://bitbucket.lmc.cz/projects/FP/repos/fp-admin/browse/Jenkinsfile#222

https://bitbucket.lmc.cz/projects/FP/repos/fp-admin/browse/bin/conventional-semver.sh

TODO: image with version tags
TODO: Image from our table with what is where

---

## Skip builds

https://bitbucket.lmc.cz/projects/FP/repos/fp-admin/browse/Jenkinsfile#64

https://bitbucket.lmc.cz/projects/FP/repos/fp-admin/browse/Jenkinsfile#218

TODO: image with build skip

---

## Shipping to PRODUCTION

---

### Problem

WHO done this?

---

### Release Actor

How to get merge actor from Bitbucket to Narwhal

```text
Tomas Litera <tomas.litera@lmc.eu>
```

TODO: image of release actor in Narwhal

---

### Jenkins ‚Üí Narwhal

Where to store it in Narwhal?

```text
description
```

TODO: image

https://bitbucket.lmc.cz/projects/COM/repos/compres-jenkins2-shared-libraries/browse/vars/createNarwhalTask.groovy#21

https://bitbucket.lmc.cz/projects/IIS/repos/kukad/browse/Jenkinsfile#267

---

### Bitbucket ‚Üí Jenkins

How to get the actor from Bitbucket to Jenkins?

WEBHOOKS!!!

---

<ul>
  <Appear>
    <li>‚ùå Parametrised Builds For Jenkins</li>
    <li>‚ùå Webhook to Jenkins for bitbucket server (it can, but did not work)</li>
    <li>‚ùå bitbucket_hook</li>
    <li>‚ùå bitbucket-scmsource-hook</li>
    <li>‚úÖ multibranch-webhook-trigger</li>
    <li>‚úÖ generic-webhook-trigger</li>
  </Appear>
</ul>

TODO: add links

---

multibranch-webhook-trigger: triggers jenkins autoscan

generic-wehbook-trigger: pass the parameters

https://bitbucket.lmc.cz/plugins/servlet/webhooks/projects/IIS/repos/kukad
https://bitbucket.lmc.cz/projects/IIS/repos/kukad/browse/Jenkinsfile#14


TODO: images

---

# Missing Concepts

---

## Deployment as a Code

<ul>
  <Appear>
    <li>file based configuration ‚Üí git repo, the single source of true</li>
    <li>Narwhal/Nomad templates</li>
    <li>one location (multiple OPS apps)</li>
    <li>https://12factor.net/</li>
  </Appear>
</ul>

---

Inspiration: Cirlce CI, Travis CI, etc...

---

## QA

<ul>
  <Appear>
    <li>How to manage pipeline between multiple Jenkins instances (integration/QA)?</li>
    <li>How to do environment resets (QA on devel6)?</li>
  </Appear>
</ul>

---

## Unified Release Flow

<ul>
  <Appear>
    <li>app versioning (git tags/semver)</li>
    <li>release notes/changelog</li>
    <li>git flow, etc...</li>
    <li>release manager (automat/bot)</li>
  </Appear>
</ul>

---

# Questions?

---

üëã
